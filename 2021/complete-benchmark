#!/bin/sh
day="$1"
part="$2"

inputfile="$PWD/inputs/$(printf '%02d' "${day##0}").txt"

if ! test -f "$inputfile"; then
	echo "no input available" >&2
	exit 1
fi

for dir in *; do
	if test -d "$dir"; then
		cd "$dir"
		if test -x ./prepare; then
			echo "---------------------------------------------------------------------------------- $dir"
			if ! ./prepare "$day" "$part" >&2; then
				echo 'eh ge hebt precies niet alles geÃ¯nstalleerd staan'
			else
				if test -x run; then
					hyperfine -n "$dir" "./run '$day' '$part' '$inputfile'"
				fi
			fi
		fi
		if test -x ./clean; then
			./clean "$day" "$part" "$inputfile"
		fi
		cd - > /dev/null 2>&1
	fi
done
